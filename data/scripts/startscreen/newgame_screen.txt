script startscreen/intro_sequence
set_fade FadeFromBlack

#We setup the grid and the player's position.
set_grid startscreen/newgame
set_player_pos [(8+0.5)*TILE_SIZE,(13+0.5)*TILE_SIZE]
disable_update_offset
set_preferred_offset [(self.world.main.screen_size[0]-(self.world.grid.gridsize[0]*TILE_SIZE))/2.0, ((self.world.main.screen_size[1]*0.5)-(self.world.grid.gridsize[1]*TILE_SIZE))/2.0]
set_offset self.world.preferred_offset

#We wait for the player to enter the cave.
wait trigger_tile 1

script startscreen/walk_player_into_cave

#The player stops and looks around...
set_player_walking False
wait delay 45
set_player_direction 0
wait delay 45
set_player_direction 2
wait delay 25

#Suddenly, there's this rumbling...
earthquake 1
play_sound room1 0.35
wait delay 30
set_player_direction 3
wait delay 250
earthquake 0
wait delay 90

#TODO: The player seems puzzled.
set_player_direction 0
wait delay 30
set_player_direction 2
wait delay 30
set_player_direction 0
wait delay 10

#Suddenly, the rumbling starts again, and the cave shuts closed!
earthquake 1
play_sound room2 0.35
wait delay 10
add_script common/player_panic
wait delay 300
play_sound roomlaugh1 0.1
transition startscreen/closed_grid_with_triggers BottomToTopWipe 120
wait end_transition
earthquake 0
wait delay 30

#(We wait for the player to be centered before stopping him.)
wait trigger_tile_touch 1
kill_script common/player_panic

#The player notices the door has closed! They're trapped!
set_player_walking False
set_player_direction 3
wait delay 60

script startscreen/transition

start_newgame